<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Baileys Pairing Dashboard</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="card">
    <h1>Baileys Pairing Dashboard</h1>

    <label>Phone number (with country code)</label>
    <input id="phone" placeholder="+48459088092" />

    <div style="margin-top:10px">
      <button id="startPair">Start Pairing (Pair Code)</button>
      <button id="startQR">Start QR Pairing</button>
    </div>

    <div class="pairing">
      <div>Pairing code: <span id="pairingCode">—</span></div>
      <div>QR (raw): <span id="qrRaw">—</span></div>
      <div>Connection: <span id="conn">idle</span></div>
    </div>

    <h3>Live log</h3>
    <div id="log" class="log"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io()
    const startPairBtn = document.getElementById('startPair')
    const startQRBtn = document.getElementById('startQR')
    const phoneEl = document.getElementById('phone')
    const pairingEl = document.getElementById('pairingCode')
    const qrRawEl = document.getElementById('qrRaw')
    const connEl = document.getElementById('conn')
    const logEl = document.getElementById('log')

    function log(type, msg) {
      const now = new Date().toLocaleTimeString()
      logEl.innerHTML = `<div>[${now}] <b>${type}</b>: ${msg}</div>` + logEl.innerHTML
    }

    startPairBtn.addEventListener('click', () => {
      const phone = phoneEl.value.trim()
      if (!phone) { alert('Enter phone number with country code'); return }
      socket.emit('startPairing', { phoneNumber: phone })
      log('client', `Requested pair-code pairing for ${phone}`)
    })

    startQRBtn.addEventListener('click', () => {
      socket.emit('startQROnly')
      log('client', 'Requested QR-only pairing')
    })

    socket.on('status', (data) => {
      const { event, payload } = data
      if (event === 'pairingCode') {
        pairingEl.textContent = payload
        log('pair', `Pairing code: ${payload}`)
      } else if (event === 'qr') {
        qrRawEl.textContent = payload
        log('qr', 'QR string received (use any QR generator to scan on phone)')
      } else if (event === 'connection') {
        connEl.textContent = payload
        log('conn', `connection state: ${payload}`)
      } else if (event === 'info') {
        log('info', payload)
      } else if (event === 'error') {
        log('error', payload)
      } else {
        log(event, payload)
      }
    })
  </script>
</body>
</html>
